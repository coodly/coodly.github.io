<div class="screenshot-gallery">
{% for screenshot in include.screenshots %}
  <div class="screenshot">
    <img src="{{ screenshot.image }}" alt="{{ screenshot.alt }}" onclick="openLightbox({{ forloop.index0 }})" data-index="{{ forloop.index0 }}">
    <p>{{ screenshot.caption }}</p>
  </div>
{% endfor %}
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
  <div class="lightbox-content">
    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
    <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImage(-1)">&#8249;</button>
    <img id="lightbox-image" class="lightbox-image" src="" alt="">
    <button class="lightbox-nav lightbox-next" onclick="changeLightboxImage(1)">&#8250;</button>
    <div id="lightbox-caption" class="lightbox-caption"></div>
  </div>
</div>

<script>
let currentImageIndex = 0;
const screenshots = [
{% for screenshot in include.screenshots %}
  {
    image: "{{ screenshot.image }}",
    alt: "{{ screenshot.alt }}",
    caption: "{{ screenshot.caption }}"
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
];

function openLightbox(index) {
  currentImageIndex = index;
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  const lightboxCaption = document.getElementById('lightbox-caption');
  
  lightboxImage.src = screenshots[index].image;
  lightboxImage.alt = screenshots[index].alt;
  lightboxCaption.textContent = screenshots[index].caption;
  
  lightbox.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeLightbox(event) {
  if (event && event.target !== event.currentTarget && !event.target.classList.contains('lightbox-close')) {
    return;
  }
  
  const lightbox = document.getElementById('lightbox');
  lightbox.classList.remove('active');
  document.body.style.overflow = '';
}

function changeLightboxImage(direction) {
  currentImageIndex += direction;
  
  if (currentImageIndex >= screenshots.length) {
    currentImageIndex = 0;
  } else if (currentImageIndex < 0) {
    currentImageIndex = screenshots.length - 1;
  }
  
  const lightboxImage = document.getElementById('lightbox-image');
  const lightboxCaption = document.getElementById('lightbox-caption');
  
  lightboxImage.src = screenshots[currentImageIndex].image;
  lightboxImage.alt = screenshots[currentImageIndex].alt;
  lightboxCaption.textContent = screenshots[currentImageIndex].caption;
}

// Keyboard navigation
document.addEventListener('keydown', function(event) {
  const lightbox = document.getElementById('lightbox');
  if (!lightbox.classList.contains('active')) return;
  
  switch(event.key) {
    case 'Escape':
      closeLightbox();
      break;
    case 'ArrowLeft':
      changeLightboxImage(-1);
      break;
    case 'ArrowRight':
      changeLightboxImage(1);
      break;
  }
});
</script>